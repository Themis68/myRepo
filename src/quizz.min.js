var scripts=[],actions=[],timeCode="",avatar="",myURLcomplete=document.location.href,myURL=myURLcomplete.substring(0,myURLcomplete.lastIndexOf("/")),quizzNbPoint=0,stepBarre=0,stepDone=0,idQuizz=null,tabMessages=["cliquez sur la vignette du quizz que vous souhaitez jouer","cliquez sur cet icône pour afficher les quizz disponibles","vous allez démarrer le quizz pour obtenir le niveau '","vous venez de terminer le quizz<br>Votre score est de <b>"],nbQuests=[{niv:"COURANT",nb:0,points:0},{niv:"j'apprends",nb:0,points:0},{niv:"je comprends",nb:0,points:0},{niv:"j'applique",nb:0,points:0},{niv:"j'explique",nb:0,points:0}],niveauQuest=1,questionsFaites=[],seqUsed=-1,hauteurContent=0,questionOn=0,tabQuestions=[],pathImages="../images/",pathQuizz="../questionnaires/",pathPosters=pathQuizz+"posters/",pathBadges=pathQuizz+"badges/";function user(){let avatarOk=!1;const reg=/^([a-zA-Z]){3,20}$/g;do{avatar=window.prompt("Indique ton prénom s'il te plait (3 à 20 lettres maximum)"),avatarOk=reg.exec(avatar)}while(!avatarOk);avatar=avatar.toUpperCase(),document.querySelector("bascule span").innerHTML=avatar+" "+tabMessages[0]}function init(){var bascule;document.querySelector("bascule img").addEventListener("click",fBascule),creerVignettes("vignettes")}function creerVignettes(id){let ind=document.getElementById("indicateurs");for(let i=0;i<arrayAssoSize(scenario);i++){let myInd=document.createElement("li");myInd.setAttribute("data-target","#carousel-example"),myInd.setAttribute("data-slide-to",i),0===i?myInd.setAttribute("class","active cercle"):myInd.setAttribute("class","cercle"),ind.appendChild(myInd)}let bloc=document.getElementById(id);for(let i=0;i<arrayAssoSize(scenario);i++){let myDiv=document.createElement("div");myDiv.className="carousel-item col-12 col-sm-6 col-md-4 col-lg-3"+(0===i?" active":"");let myImg=document.createElement("img");myImg.className="img-fluid mx-auto d-block",myImg.setAttribute("alt","img"+i),myImg.setAttribute("title","img"+i),myImg.setAttribute("src",pathPosters+(scenario[i][0].poster||pathImages+"pelouses/stade.jpg"));let myCaption=document.createElement("div"),myF=document.createElement("img");myF.className="carouselFanion",myF.setAttribute("title","niveau : "+nbQuests[scenario[i][0].niveau].niv),myF.setAttribute("src",pathBadges+"badge"+(scenario[i][0].niveau+".png"||"fff.png'")),myCaption.appendChild(myF);let myP=document.createElement("p");myP.innerHTML=scenario[i][0].titre,myCaption.appendChild(myP),myCaption.className="carousel-caption d-none d-md-block titre",myCaption.setAttribute("onclick","javascript:switchQuizz("+scenario[i][0].id+");"),myDiv.appendChild(myImg),myDiv.appendChild(myCaption),bloc.appendChild(myDiv);let myScript=document.createElement("SCRIPT");myScript.setAttribute("type","text/javascript"),myScript.setAttribute("src",pathQuizz+scenario[i][0].fichier),document.head.appendChild(myScript)}}function showContent(etat){let carousel,bascule_img,bascule_titre;document.getElementById("carousel").style.display=!0===etat?"none":"flex",document.querySelector("bascule img").setAttribute("src",pathImages+(!0===etat?"fleche_fermee.png":"fleche_ouverte.png")),document.querySelector("bascule span").innerHTML=avatar+" "+(!0===etat?tabMessages[1]:tabMessages[0])}function fBascule(event){let carousel=document.querySelector("carousel"),span=document.querySelector("bascule span");this.src.indexOf("fermee")>0?(carousel.style.display="flex",this.src=pathImages+"fleche_ouverte.png",this.alt="affiche la liste des quizz",span.innerHTML=avatar+" "+tabMessages[0]):(carousel.style.display="none",this.src=pathImages+"fleche_fermee.png",this.alt="masque la liste des quizz",span.innerHTML=avatar+" "+tabMessages[1])}function switchQuizz(n){if(n>arrayAssoSize(scenario))return n=0,!1;quizz=scenario[n-1],tabQuestions=eval("script"+n),showContent(!0),gestionBoard("selectQuizz",quizz[0])}function gestionBoard(etape,objet){let inter=document.querySelector("inter");switch(etape){case"selectQuizz":gestNiveaux(objet.niveau),scanQuestion(objet.niveau),gestJauge(0,objet.niveau),document.querySelector("inter question p").style.display="none",document.querySelector("inter propositions").style.display="none",document.querySelector("inter complement").style.display="flex",document.querySelector("inter complement p").innerHTML=avatar+" "+tabMessages[2]+" "+nbQuests[niveauQuest].nivv+"'.",document.querySelector("inter complement img").style.display="none",document.querySelector("inter tete score p").style.display="none",addScore(0),document.querySelector("inter suite next").style.display="flex",document.querySelector("inter suite chrono").style.display="none",document.querySelector("inter").style.display="flex";break;case"InterQuestion":let pChrono;document.querySelector("inter complement").style.display="none",document.querySelector("inter complement p").innerHTML=avatar+" "+tabMessages[3]+" "+nbQuests[niveauQuest].points+" points</b>",document.querySelector("inter tete score p").style.display="flex",gestJauge(questionOn,objet.niveau),document.querySelector("inter question p").style.display="flex",document.querySelector("inter question p").innerHTML=objet.question.libelle,gestPropositions("afficher",objet),document.querySelector("inter propositions").style.display="flex",document.querySelector("inter suite").style.display="flex",document.querySelector("inter suite next").style.display="none",document.querySelector("inter suite chrono p").innerHTML=objet.reponse.temps,document.querySelector("inter suite chrono").style.display="flex",myChrono=setInterval(chrono,1e3,objet.reponse);break;case"QuizzTermine":document.querySelector("inter complement").style.display="flex",document.querySelector("inter tete score p").style.display="flex",document.querySelector("inter question p").style.display="none",document.querySelector("inter propositions").style.display="none",document.querySelector("inter suite").style.display="flex",document.querySelector("inter suite chrono").style.display="none";break;default:inter.display="none"}}function chrono(reponse){let pChrono=document.querySelector("inter suite chrono p"),value=parseInt(pChrono.innerHTML,10);0==value?response(questionOn,-1):(value<=4&&playSound("comptearebours"),pChrono.innerHTML=(value-1).toString())}function response(numQ,propSel){clearTimeout(myChrono);for(let i=0;i<4;i++)document.getElementsByClassName("prop"+(i+1))[0].setAttribute("style","filter:brightness(500%);");myQ=tabQuestions[numQ-1],propSel!=myQ.reponse.solution?playSound("mauvaise"):(playSound("bonne"),document.getElementsByClassName("prop"+propSel)[0].setAttribute("style","filter:drop-shadow(2px 4px 6px black);"),addScore(myQ.reponse.points)),questionOn++,document.querySelector("inter suite chrono").style.display="none",document.querySelector("inter suite next").style.display="flex"}function addScore(value){0===value?quizzNbPoint=0:quizzNbPoint+=value;var score=("0"+quizzNbPoint.toString()).substr(-2),scoreMax=("0"+nbQuests[niveauQuest].points.toString()).substr(-2);let myColor,myScore='<span style="color:'+(quizzNbPoint/nbQuests[niveauQuest].points>.5?"green":"black")+';">'+score+"</span>";document.querySelector("inter tete score p").innerHTML=myScore+":"+scoreMax}function gestNiveaux(niveau){let myBadge=document.querySelector("inter tete niveau");img=document.createElement("img"),img.id="badge",img.setAttribute("title",nbQuests[niveau].niv),img.setAttribute("alt",nbQuests[niveau].niv),img.setAttribute("src",pathBadges+"badge"+niveau+".png"),myBadge.appendChild(img)}function scanQuestion(niveau){tabQuestions=[];let script=eval("script"+niveau);for(let ind=0;ind<arrayAssoSize(nbQuests);ind++)nbQuests[ind].nb=0,nbQuests[ind].points=0;let indexSelQuestions=0;for(let ind=0;ind<arrayAssoSize(script);ind++)script[ind].niveau==niveau&&(nbQuests[script[ind].niveau].nb++,nbQuests[script[ind].niveau].points+=script[ind].reponse.points,tabQuestions[indexSelQuestions]=script[ind],indexSelQuestions++);niveauQuest=niveau,questionOn=1}function gestJauge(numQuest,niveau){let pourCent=0,jauge=document.getElementsByClassName("progress-bar");0==numQuest?(jauge[0].setAttribute("aria-valuenow",0),jauge[0].setAttribute("style","width: 0%"),jauge[0].innerHTML=nbQuests[niveau].nb+" Questions"):(jauge[0].setAttribute("aria-valuenow",numQuest),pourCent=numQuest/nbQuests[niveau].nb*100,jauge[0].setAttribute("style","width: "+pourCent+"%"),jauge[0].innerHTML=numQuest)}function continuer(){if(document.querySelector("inter suite next").style.display="none",questionOn>nbQuests[niveauQuest].nb)questionOn=0,showContent(!0),gestionBoard("QuizzTermine");else{for(let i=0;i<4;i++)document.getElementsByClassName("prop"+(i+1))[0].setAttribute("style","filter:brightness(100%);");gestionBoard("InterQuestion",tabQuestions[questionOn-1])}}function gestPropositions(etape,objet){for(let i=0;i<4;i++){let myCard,myProp;document.getElementById("card"+(i+1)).setAttribute("onclick","javascript:response("+questionOn+","+(i+1)+");"),document.getElementById("prop"+(i+1)).innerHTML=objet.question.attributs[i]}}document.addEventListener("DOMContentLoaded",init,!1);